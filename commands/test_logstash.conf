input {
        beats {
                port => 5044
        }
 
        tcp {
                port => 5000
        }
}
 
filter {
     if [type] == "profile_blockio" {
	       csv {
		  columns => ["min_usecs","max_usecs","count"]
		  separator => ","
	       }
	       mutate {
		  convert => {"min_usecs" => "integer"}
               }
               mutate {
		  convert => {"max_usecs" => "integer"}
               }
               mutate {
		  convert => {"count" => "integer"}
               }
      }
      
     if [type] == "execsnoop" {
	       csv{
		  columns => ["TIME","PCOMM","PID","PPID","RET","ARGS"]
		  separator => ","
	       }
	       mutate {
		  convert => {"PID" => "integer"}
               }
               mutate {
		  convert => {"PPID" => "integer"}
               }
               mutate {
		  convert => {"RET" => "integer"}
               }
      }
      
      if [type] == "exitsnoop" {
	       csv {
		  columns => ["TIME-PKT","PCOMM","PID","PPID","TID","AGE(s)","EXIT_CODE"]
		  separator => ","
	       }
	       mutate {
		  convert => {"PID" => "integer"}
               }
               mutate {
		  convert => {"PPID" => "integer"}
               }
               mutate {
		  convert => {"TID" => "integer"}
               }
               mutate {
		  convert => {"AGE(s)" => "integer"}
               }
               mutate {
		  convert => {"EXIT_CODE" => "integer"}
               }
      }
      
      if [type] == "gethostlatency" {
	       csv {
		  columns => ["TIME","PID","COMM","LATms","HOST"]
		  separator => ","
	       }
	       mutate {
		  convert => {"PID" => "integer"}
               }
               mutate {
		  convert => {"LATms" => "integer"}
               }
      }
      
      if [type] == "tcprtt" {
	       csv {
		  columns => ["min_usecs","max_usecs","count"]
		  separator => ","
	       }
	       mutate {
		  convert => {"min_usecs" => "integer"}
               }
               mutate {
		  convert => {"max_usecs" => "integer"}
               }
               mutate {
		  convert => {"count" => "integer"}
               }
      }

      if [type] == "tcpconnect" {
	       csv {
		  columns => ["PID","COMM","IP","SADDR","DADDR","DPORT","QUERY"]
		  separator => ","
	       }
	       mutate {
		  convert => {"PID" => "integer"}
               }
               mutate {
		  convert => {"IP" => "integer"}
               }
               mutate {
		  convert => {"DPORT" => "integer"}
               }
      }

      if [type] == "runqlat" {
	       csv {
		  columns => ["min_usecs","max_usecs","count"]
		  separator => ","
	       }
	       mutate {
		  convert => {"min_usecs" => "integer"}
               }
               mutate {
		  convert => {"max_usecs" => "integer"}
               }
               mutate {
		  convert => {"count" => "integer"}
               }
      }
      
      
      if [type] == "tcplife" {
	       csv {
		  columns => ["TIME","PID","COMM","LADDR","LPORT","RADDR","RPORT","TX_KB","RX_KB","MS"]
		  separator => ","
	       }
	       mutate {
		  convert => {"PID" => "integer"}
               }
               mutate {
		  convert => {"LPORT" => "integer"}
               }
               mutate {
		  convert => {"RPORT" => "integer"}
               }
               mutate {
		  convert => {"TX_KB" => "integer"}
               }
               mutate {
		  convert => {"RX_KB" => "integer"}
               }
               mutate {
		  convert => {"MS" => "integer"}
               }
      }
      
      if [type] == "cpudist" {
	       csv {
		  columns => ["min_usecs","max_usecs","count"]
		  separator => ","
	       }
	       mutate {
		  convert => {"min_usecs" => "integer"}
               }
               mutate {
		  convert => {"max_usecs" => "integer"}
               }
               mutate {
		  convert => {"count" => "integer"}
               }
      }
      

      if [type] == "biolatency" {
	       csv {
		  columns => ["min_usecs","max_usecs","count"]
		  separator => ","
	       }
	       mutate {
		  convert => {"min_usecs" => "integer"}
               }
               mutate {
		  convert => {"max_usecs" => "integer"}
               }
               mutate {
		  convert => {"count" => "integer"}
               }
      }
      
      if [type] == "biolatpcts_sda" {
	       csv {
		  columns => ["operation","1","5","10","16","25","50","75","84","90","95","99","100"]
		  separator => ","
	       }
	       mutate {
		  convert => {"1" => "integer"}
               }
               mutate {
		  convert => {"5" => "integer"}
               }
               mutate {
		  convert => {"10" => "integer"}
               }
               mutate {
		  convert => {"16" => "integer"}
               }
               mutate {
		  convert => {"25" => "integer"}
               }
               mutate {
		  convert => {"50" => "integer"}
               }
               mutate {
		  convert => {"75" => "integer"}
               }
               mutate {
		  convert => {"84" => "integer"}
               }
               mutate {
		  convert => {"90" => "integer"}
               }
               mutate {
		  convert => {"95" => "integer"}
               }
               mutate {
		  convert => {"99" => "integer"}
               }
               mutate {
		  convert => {"100" => "integer"}
               }
               
      }
      
}


output {
      if [type] == "profile_blockio" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "profile_blockio"
	}
      }

      if [type] == "execsnoop" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "execsnoop"
	}
      }
      
      if [type] == "exitsnoop" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "exitsnoop"
	}
      }
      
      
      if [type] == "gethostlatency" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "gethostlatency"
	}
      }
      
      if [type] == "tcprtt" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "tcprtt"
	}
      }
      
      if [type] == "tcpconnect" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "tcpconnect"
	}
      }

      if [type] == "runqlat" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "runqlat"
	}
      }
      
      if [type] == "tcplife" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "tcplife"
	}
      }
      
      if [type] == "cpudist" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "cpudist"
	}
      }
      
      if [type] == "biolatency" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "biolatency"
	}
      }
      
     if [type] == "biolatpcts_sda" {
	elasticsearch {
	        hosts => "elasticsearch:9200"
	        user => "elastic"
	        password => "changeme"
	        index => "biolatpcts_sda"
	}
      }
}
