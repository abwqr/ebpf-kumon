name: my-k8s-stack
runtime: yaml
description: A program to deploy Cilium CNI and OpenTelemetry Collector on Kubernetes

resources:
  k8sProvider:
    type: kubernetes:Provider
    properties:
      kubeconfig: ${kubernetes:config:kubeconfig}

  ciliumRelease:
    type: kubernetes:helm.sh/v3:Release
    properties:
      name: "cilium"
      chart: "cilium"
      version: "1.11.1"
      namespace: "kube-system"
      repositoryOpts:
        repo: "https://helm.cilium.io/"
    options:
      provider: ${k8sProvider}

  otelCollectorRelease:
    type: kubernetes:helm.sh/v3:Release
    properties:
      name: "opentelemetry-collector"
      chart: "opentelemetry-collector"
      version: "0.7.0"
      namespace: "opentelemetry"
      repositoryOpts:
        repo: "https://open-telemetry.github.io/opentelemetry-helm-charts"
      # values here should be structured as they would be in a typical Helm values.yaml file.
      # Example: values: {key1: value1, key2: value2}
    options:
      provider: ${k8sProvider}

outputs:
  ciliumStatus: ${ciliumRelease.status}
  otelCollectorStatus: ${otelCollectorRelease.status}

